<!DOCTYPE html>
<html lang="fr">
	<head>
		<title>Cap'Chat</title>
		<meta charset="utf-8">
		<link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
		<link href="public/captchat.css" rel="stylesheet">
		<script defer src="public/captchat.js"></script>
		<script>
			const refreshTime = 10000

			/* From Minuterie */
			let t = refreshTime + 0

			function runHorloge() {
				debuter(new Date().getTime(), t)
			}

			function debuter(debut, timer) {
				const d = new Date()
				window.intOffset = timer - (d.getTime() - debut)

				temps.innerHTML = Math.ceil(window.intOffset / 1000)

				const mult = 60000 / t
				window.angle = 0.1048335 * 0.001 * mult * window.intOffset

				if (window.intOffset <= 0) {
					return
				}
				drawHorloge(1)

				window.t = setTimeout(`debuter(${debut}, ${timer})`, 16)
			}

			function changeColor(angle) {
				angle = 6.29 - angle;
				const r = Math.floor(72 + 55 * angle)
				const b = Math.floor(214 + 14 * angle)

				return (r < 255 || b < 255)
					? `rgb(${r}, ${b}, 0)`
					: `rgb(${Math.floor(255)}, ${Math.floor(597 - (90 * angle))}, 0)`
			}

			function drawHorloge(pourcent) {
				const canvas = document.getElementById("horloge")
				const ctx = canvas.getContext("2d")
				const twoPI = Math.PI * 2

				ctx.clearRect(0, 0, 300, 300)

				ctx.beginPath()
				ctx.globalAlpha = 1
				ctx.arc(150, 150, 140, 0, 6.283, false)
				ctx.arc(150, 150, 105, 6.283, twoPI, true)
				ctx.fillStyle = "#bbb"
				ctx.fill()
				ctx.closePath()

				ctx.beginPath()
				ctx.globalAlpha = 1
				ctx.arc(150, 150, 140.1, -1.57, (-1.57 + window.angle), false)
				ctx.arc(150, 150, 105, (-1.57 + window.angle), (twoPI - 1.57), true)
				ctx.fillStyle = changeColor(window.angle)
				ctx.fill()
				ctx.closePath()

				ctx.beginPath()
				ctx.arc(150, 150, (105 * pourcent), 0, 6.283, false)
				ctx.fillStyle = "#fff"
				ctx.fill()
				ctx.closePath()
			}

			function refreshCaptcha(ctx) {
				ctx.clearRect(0, 0, canvas.width, canvas.height)


				clearTimeout(window.t)
				runHorloge()
			}

			window.setTimeout(() => window.setInterval(() => captchat_reload(), refreshTime), t - refreshTime)
			window.setTimeout(() => t = refreshTime, t)
		</script>
	</head>
	<body>
		<main>
			<div id="captchat"></div>
		</main>
	</body>
</html>
